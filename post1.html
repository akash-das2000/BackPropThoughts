<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>How I Fine-Tuned an LLM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>How I Fine-Tuned an LLM</h1>
  </header>

  <main>
    <p>In this post, I describe how I used LoRA and GRPO to fine-tune a transformer model with minimal resources...</p>

    <!-- üëè Claps and üí¨ Comments Toggle -->
    <section id="social-actions">
      <button id="clap-btn">üëè <span id="clap-count">0</span></button>
      <button id="toggle-comments-btn">üí¨ Comments</button>
    </section>

    <!-- üí¨ Comments Section (Initially Hidden) -->
    <section id="comments-area" style="display: none;">
      <h2>Leave a Comment</h2>
      <form id="comment-form">
        <input type="text" id="name" placeholder="Your name" required><br><br>
        <textarea id="comment" placeholder="Your comment" rows="5" required></textarea><br><br>
        <button type="submit">Post Comment</button>
      </form>

      <h2>Comments</h2>
      <div id="comments-section">Loading comments...</div>
    </section>
  </main>

  <footer>
    <p><a href="index.html">‚Üê Back to Home</a></p>
  </footer>

  <!-- ‚úÖ Firebase SDK + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      doc,
      addDoc,
      getDoc,
      setDoc,
      updateDoc,
      increment,
      query,
      where,
      orderBy,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // üîß Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyA3AkLphGPQy35cLP1rEt0g3hp4SQpt4XE",
      authDomain: "backpropthoughtscomments.firebaseapp.com",
      projectId: "backpropthoughtscomments",
      storageBucket: "backpropthoughtscomments.appspot.com",
      messagingSenderId: "903589800417",
      appId: "1:903589800417:web:d605b4eadde34a4dd78aa0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const postId = "post1";

    // üëè Handle Claps with LocalStorage Restriction
    const clapBtn = document.getElementById("clap-btn");
    const clapCount = document.getElementById("clap-count");
    const likesRef = doc(db, "likes", postId);
    const localKey = `clapped-${postId}`;

    getDoc(likesRef).then((docSnap) => {
      if (docSnap.exists()) {
        clapCount.textContent = docSnap.data().claps || 0;
      } else {
        setDoc(likesRef, { claps: 0 });
      }
    });

    clapBtn.addEventListener("click", async () => {
      if (localStorage.getItem(localKey)) {
        alert("You've already clapped for this post!");
        return;
      }

      await updateDoc(likesRef, { claps: increment(1) });
      const current = parseInt(clapCount.textContent);
      clapCount.textContent = current + 1;
      localStorage.setItem(localKey, "true");
    });

    // üí¨ Toggle Comments
    const commentsArea = document.getElementById("comments-area");
    document.getElementById("toggle-comments-btn").addEventListener("click", () => {
      commentsArea.style.display = commentsArea.style.display === "none" ? "block" : "none";
    });

    // üí¨ Submit Comment
    const form = document.getElementById("comment-form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const comment = document.getElementById("comment").value.trim();
      if (name && comment) {
        await addDoc(collection(db, "comments"), {
          name,
          comment,
          postId,
          timestamp: serverTimestamp()
        });
        form.reset();
      }
    });

    // üí¨ Load Comments
    const commentBox = document.getElementById("comments-section");
    const q = query(
      collection(db, "comments"),
      where("postId", "==", postId),
      orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snapshot) => {
      commentBox.innerHTML = "";
      if (snapshot.empty) {
        commentBox.innerHTML = "<p>No comments yet. Be the first!</p>";
      }
      snapshot.forEach((doc) => {
        const data = doc.data();
        let time = "Just now";
        try {
          if (data.timestamp && data.timestamp.toDate) {
            time = data.timestamp.toDate().toLocaleString();
          }
        } catch (e) {}
        const div = document.createElement("div");
        div.classList.add("comment");
        div.innerHTML = `<strong>${data.name}</strong> <em>${time}</em><p>${data.comment}</p><hr>`;
        commentBox.appendChild(div);
      });
    });
  </script>
</body>
</html>
