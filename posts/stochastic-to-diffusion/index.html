<section>
  <!-- ========== Blog Title ========== -->
  <h1 id="heading">
    From Brownian Motion to Discrete Diffusion: The Mathematical Foundations of DDPM
  </h1>

  <!-- ========== TL;DR Summary (no math here) ========== -->
  <aside class="tldr">
    <h2 id="TL;DR">TL;DR</h2>
    <p>
      This post traces the mathematical spine of diffusion models, building a clear path from stochastic calculus to practical algorithms:
    </p>
    <ol>
      <li><strong>Brownian motion &amp; Itô calculus:</strong> Understand how stochastic processes evolve and why (dBₜ)² = dt is key.</li>
      <li><strong>Fokker–Planck PDE:</strong> Show how SDEs induce PDEs for probability densities.</li>
      <li><strong>Reverse-time SDE:</strong> Step-by-step derivation of reverse drift from Anderson (1982) → Song et al. (2020).</li>
      <li><strong>Discrete DDPM:</strong> Derive forward noising schedule and variational ELBO.</li>
      <li><strong>Toy model:</strong> Minimal Python DDPM to visualize forward/reverse diffusion.</li>
    </ol>
    <p>
      By the end, you'll see Ho et al. (2020) as a direct descendant of stochastic calculus.
    </p>
  </aside>

  <!-- ========== Introduction Section ========== -->
  <h2 id="introduction">Introduction</h2>
  <p class="lead">
    Diffusion models progressively corrupt data with Gaussian noise and learn to reverse that process.
    Underneath lies a rich interplay of stochastic calculus, PDEs, and variational inference.
  </p>
  <p>
    This blog continues our journey from <a href="https://backpropthoughts.netlify.app/post?postId=diffusion-maths" target="_blank">the previous post on score matching</a>. Here we dive deep into:
  </p>
  <ul>
    <li>Brownian motion: why \((dB_t)^2 = dt\) is central to stochastic integrals.</li>
    <li>Fokker–Planck equation: deriving density evolution from SDEs.</li>
    <li>Reverse-time SDE: unlocking the denoising step.</li>
    <li>Discrete DDPM: bridging continuous SDEs to Ho et al.'s formulation.</li>
  </ul>
  <p class="bridge">
    Along the way, we’ll offer rigorous proofs and practical code, building a solid foundation for understanding diffusion models mathematically.
  </p>

  <!-- ========== Section 2: Brownian Motion & Quadratic Variation ========== -->
  <h2 id="brownian-motion">2. Brownian Motion &amp; Quadratic Variation</h2>

  <!-- ----- 2.1 Intuition ----- -->
  <h3 id="brownian-intuition">2.1 Intuition: Brownian Motion and Quadratic Variation</h3>
  <p class="lead">
    Brownian motion, or Wiener process, is the cornerstone of stochastic calculus.
    It describes a continuous-time random walk with independent Gaussian increments:
  </p>
  <div class="eq-scroll">
    \[
      B_{t+s} - B_t \sim \mathcal{N}(0, s),
      \quad \text{for all } s \geq 0.
    \tag{1}
    \]
  </div>
  <ul>
    <li><strong>Independent increments:</strong> Each step is independent of the past.</li>
    <li><strong>Variance scaling:</strong> \(\mathrm{Var}[B_t] = t\).</li>
  </ul>
  <p class="bridge">
    Crucially, Brownian paths are nowhere differentiable but have a well-defined quadratic variation:
  </p>
  <div class="eq-scroll">
    \[
      (dB_t)^2 = dt.
    \tag{2}
    \]
  </div>

  <!-- ----- 2.2 Proof ----- -->
  <h3 id="brownian-proof">2.2 Proof: Why \((dB_t)^2 = dt\)</h3>
  <p class="lead">
    Let’s rigorously show how quadratic variation leads to this key identity.
  </p>
  <p>
    Partition \([0, t]\) into \(n\) intervals of width \(\Delta t = t/n\). The increments:
  </p>
  <div class="eq-scroll">
    \[
      \Delta B_i = B_{t_i} - B_{t_{i-1}} \sim \mathcal{N}(0, \Delta t).
    \tag{3}
    \]
  </div>
  <p>
    The quadratic variation of \(B_t\) is:
  </p>
  <div class="eq-scroll">
    \[
      [B]_t = \lim_{n \to \infty} \sum_{i=1}^n (\Delta B_i)^2.
    \tag{4}
    \]
  </div>
  <p>
    Since \(\mathbb{E}[(\Delta B_i)^2] = \Delta t\), the expected sum:
  </p>
  <div class="eq-scroll">
    \[
      \mathbb{E}\left[\sum_{i=1}^n (\Delta B_i)^2\right] = n\Delta t = t.
    \tag{5}
    \]
  </div>
  <p class="bridge">
    As \(n \to \infty\), this converges in probability:
  </p>
  <div class="eq-scroll">
    \[
      [B]_t = t.
    \tag{6}
    \]
  </div>
  <p class="explain">
    In differential form, \((dB_t)^2 = dt\) becomes the cornerstone of Itô calculus.
  </p>

  <!-- ----- 2.3 Connection to Diffusion Models ----- -->
  <h3 id="brownian-connection">2.3 Connection to Diffusion Models</h3>
  <p class="lead">
    The identity \((dB_t)^2 = dt\) is not just an abstract feature of Brownian motion; it is the
    linchpin in the mathematics of diffusion models.
  </p>
  <p>
    Consider a stochastic differential equation (SDE):
  </p>
  <div class="eq-scroll">
    \[
      dx_t = \mu(x_t, t)\,dt + \sigma(t)\,dB_t.
    \tag{7}
    \]
  </div>
  <p>
    Here \(\mu(x_t, t)\) is the drift and \(\sigma(t)\) the diffusion coefficient. When applying Itô’s lemma:
  </p>
  <ul>
    <li><strong>\(dB_t\):</strong> contributes random noise.</li>
    <li><strong>\((dB_t)^2\):</strong> contributes deterministic drift correction via \(dt\).</li>
  </ul>
  <p class="bridge">
    Without \((dB_t)^2=dt\), the derivation of the <strong>Fokker–Planck PDE</strong> (Section 3) and the
    <strong>reverse-time SDE</strong> (Section 4) would break down.
  </p>
  <p class="note">
    <strong>Key Takeaway:</strong> \((dB_t)^2=dt\) bridges random fluctuations to smooth density evolution, enabling Gaussian marginals.
  </p>
</section>
