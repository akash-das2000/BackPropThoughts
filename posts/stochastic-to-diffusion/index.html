<style>
  /* Put your styles here */
  /* ----------  TL;DR call-out ---------- */
/* ----------  TL;DR call-out (greyscale theme) ---------- */
.tldr {
  border: 1px solid #c0c0c0;      /* soft grey border */
  border-radius: 0.5rem;
  padding: 1rem 1.25rem;
  background: #f5f5f5;            /* very light grey background */
  color: #333;                    /* dark grey text for readability */
}

.tldr h2 {
  margin: 0 0 0.5rem 0;
  color: #111;                    /* nearly black for the heading */
}

.tldr ol {
  margin-left: 1.3rem;
}

.tldr li strong {
  color: #000;                    /* highlight keywords in pure black */
}

/* ----------  Ensure TL;DR inline math and text wrap on mobile  ---------- */
.tldr,
.tldr p,
.tldr ol,
.tldr li {
  /* allow words, symbols, and math to break anywhere if needed */
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  hyphens: auto;
  white-space: normal;
}

/* target KaTeX/MathJax inline spans if you’re using them */
.tldr .katex,
.tldr .MathJax,
.tldr span {
  display: inline-block;
  max-width: 100%;
  white-space: normal;
}

/* shrink font slightly for extra safety on very small screens */
@media (max-width: 400px) {
  .tldr {
    font-size: 0.90rem;
  }
}


/* ----------  table styling ---------- */
table.tbl{
  width:100%;
  border-collapse:collapse;
  margin:2rem 0 2.5rem 0;
  font-size:.95rem;
}
table.tbl caption{
  caption-side:top;
  font-weight:600;
  margin-bottom:.4rem;
}
table.tbl th,
table.tbl td{
  border:1px solid #d0d0d0;
  padding:.45rem .65rem;
  text-align:left;
  vertical-align:top;
}
table.tbl thead{background:#f5f7ff;}
.tbl .shape{
  font-family:"Roboto Mono",ui-monospace,monospace;
  white-space:nowrap;
}
.fact-table th{
  background:#f5f5f5;
  width:160px;
}

/* ----------  lead paragraph ---------- */
.lead{
  font-size:1.05rem;
  line-height:1.6;
  margin:1.2rem 0 2rem 0;
  color:#333;
}
.lead ul{margin:.6rem 0 .6rem 1.4rem}

/* ----------  bridge note ---------- */
.bridge{
  font-size:.95rem;
  margin:.8rem 0 1.1rem 0;
  color:#444;
}            /* <— THIS was the missing brace */

/* ----------  display equations ---------- */
.eq-scroll{
  display:block;
  overflow-x:auto;
  white-space:nowrap;
  text-align:center;
  margin:1.2rem auto;
  font-size:1.02rem;
}
@media(max-width:600px){
  .eq-scroll{font-size:.9rem}
  table.tbl{font-size:.9rem}
}

/* ----------  inline & block code ---------- */
code,pre{
  font-family:"Fira Code","SFMono-Regular",ui-monospace,monospace;
  font-size:.92rem;
}
code{
  background:#f3f4f6;
  color:#1a1a1a;
  padding:0 .25em;
  border-radius:4px;
}
pre{
  background:#f8f9fb;
  border:1px solid #cfd2d7;
  border-radius:6px;
  padding:.9rem 1rem;
  line-height:1.45;
  overflow-x:auto;
  margin:1.6rem 0;
}
pre code{background:none;padding:0}
@media(max-width:600px){
  pre{font-size:.82rem}
  code{font-size:.86rem}
}

/* ----------  GitHub-style code card ---------- */
.code-card{
  background:#f6f8fa;
  border:1px solid #d0d7de;
  border-radius:6px;
  overflow:hidden;
  margin:1.6rem 0;
}
.code-card .code-header{
  background:#eaeef2;
  border-bottom:1px solid #d0d7de;
  font:.75rem/1 system-ui,sans-serif;
  color:#24292f;
  padding:.45rem .9rem;
  text-transform:lowercase;
}
.code-card pre{
  margin:0;
  padding:.8rem 1rem;
  background:inherit;
  font-size:.92rem;
  white-space:pre;
}
@media(max-width:600px){
  .code-card pre{font-size:.82rem}
}
  
/* === let wide tables side-scroll on narrow screens === */
@media (max-width: 600px){
  table.tbl{
    display:block;          /* makes it a scroll container   */
    overflow-x:auto;        /* side-scroll if too wide        */
    -webkit-overflow-scrolling: touch;
  }
  table.tbl thead,
  table.tbl tbody{
    display:table;          /* keeps header & body aligned    */
    width:100%;
  }
  table.tbl th,
  table.tbl td{
    white-space:nowrap;     /* prevent ugly line wraps        */
  }
}

/* ----------  Responsive heading wraps & scaling ---------- */

/* Allow long words in headings to break */
h1, h2, h3, h4, h5, h6 {
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
  white-space: normal;       /* override any no-wrap */
}

/* Shrink heading text on narrow viewports */
@media (max-width: 600px) {
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.3rem; }
  h3 { font-size: 1.15rem; }
  /* you can add h4, h5 as needed */
}

/* Optional: make the entire page text flow better on mobile */
body {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Override scroll-to-top button on mobile so it never hangs off-screen */
#scrollTopBtn {
  /* default for desktop */
  bottom: 2rem;
  right: 2rem;
}

/* on small viewports, reduce the offsets & size */
@media (max-width: 600px) {
  #scrollTopBtn {
    bottom: 1rem !important;
    right: 1rem !important;
    padding: 0.4rem 0.6rem !important;
    font-size: 1rem !important;
    max-width: 2.5rem;    /* ensure it stays compact */
    max-height: 2.5rem;
  }
}



</style>


<section>
  <!-- ========== Blog Title ========== -->
  <h1 id="heading">
    From Brownian Motion to Discrete Diffusion: The Mathematical Foundations of DDPM
  </h1>

  <!-- ========== TL;DR Summary (no math here) ========== -->
  <aside class="tldr">
    <h2 id="TL;DR">TL;DR</h2>
    <p>
      This post traces the mathematical spine of diffusion models, building a clear path from stochastic calculus to practical algorithms:
    </p>
    <ol>
      <li><strong>Brownian motion &amp; Itô calculus:</strong> Understand how stochastic processes evolve and why (dBₜ)² = dt is key.</li>
      <li><strong>Fokker–Planck PDE:</strong> Show how SDEs induce PDEs for probability densities.</li>
      <li><strong>Reverse-time SDE:</strong> Step-by-step derivation of reverse drift from Anderson (1982) → Song et al. (2020).</li>
      <li><strong>Discrete DDPM:</strong> Derive forward noising schedule and variational ELBO.</li>
      <li><strong>Toy model:</strong> Minimal Python DDPM to visualize forward/reverse diffusion.</li>
    </ol>
    <p>
      By the end, you'll see Ho et al. (2020) as a direct descendant of stochastic calculus.
    </p>
  </aside>

  <!-- ========== Introduction Section ========== -->
  <h2 id="introduction">Introduction</h2>
  <p class="lead">
    Diffusion models progressively corrupt data with Gaussian noise and learn to reverse that process.
    Underneath lies a rich interplay of stochastic calculus, PDEs, and variational inference.
  </p>
  <p>
    This blog continues our journey from <a href="https://backpropthoughts.netlify.app/post?postId=diffusion-maths" target="_blank">the previous post on score matching</a>. Here we dive deep into:
  </p>
  <ul>
    <li>Brownian motion: why \((dB_t)^2 = dt\) is central to stochastic integrals.</li>
    <li>Fokker–Planck equation: deriving density evolution from SDEs.</li>
    <li>Reverse-time SDE: unlocking the denoising step.</li>
    <li>Discrete DDPM: bridging continuous SDEs to Ho et al.'s formulation.</li>
  </ul>
  <p class="bridge">
    Along the way, we’ll offer rigorous proofs and practical code, building a solid foundation for understanding diffusion models mathematically.
  </p>

  <!-- ========== Section 2: Brownian Motion & Quadratic Variation ========== -->
  <h2 id="brownian-motion">2. Brownian Motion &amp; Quadratic Variation</h2>

  <!-- ----- 2.1 Intuition ----- -->
  <h3 id="brownian-intuition">2.1 Intuition: Brownian Motion and Quadratic Variation</h3>
  <p class="lead">
    Brownian motion, or Wiener process, is the cornerstone of stochastic calculus.
    It describes a continuous-time random walk with independent Gaussian increments:
  </p>
  <div class="eq-scroll">
    \[
      B_{t+s} - B_t \sim \mathcal{N}(0, s),
      \quad \text{for all } s \geq 0.
    \tag{1}
    \]
  </div>
  <ul>
    <li><strong>Independent increments:</strong> Each step is independent of the past.</li>
    <li><strong>Variance scaling:</strong> \(\mathrm{Var}[B_t] = t\).</li>
  </ul>
  <p class="bridge">
    Crucially, Brownian paths are nowhere differentiable but have a well-defined quadratic variation:
  </p>
  <div class="eq-scroll">
    \[
      (dB_t)^2 = dt.
    \tag{2}
    \]
  </div>

  <!-- ----- 2.2 Proof ----- -->
  <h3 id="brownian-proof">2.2 Proof: Why \((dB_t)^2 = dt\)</h3>
  <p class="lead">
    Let’s rigorously show how quadratic variation leads to this key identity.
  </p>
  <p>
    Partition \([0, t]\) into \(n\) intervals of width \(\Delta t = t/n\). The increments:
  </p>
  <div class="eq-scroll">
    \[
      \Delta B_i = B_{t_i} - B_{t_{i-1}} \sim \mathcal{N}(0, \Delta t).
    \tag{3}
    \]
  </div>
  <p>
    The quadratic variation of \(B_t\) is:
  </p>
  <div class="eq-scroll">
    \[
      [B]_t = \lim_{n \to \infty} \sum_{i=1}^n (\Delta B_i)^2.
    \tag{4}
    \]
  </div>
  <p>
    Since \(\mathbb{E}[(\Delta B_i)^2] = \Delta t\), the expected sum:
  </p>
  <div class="eq-scroll">
    \[
      \mathbb{E}\left[\sum_{i=1}^n (\Delta B_i)^2\right] = n\Delta t = t.
    \tag{5}
    \]
  </div>
  <p class="bridge">
    As \(n \to \infty\), this converges in probability:
  </p>
  <div class="eq-scroll">
    \[
      [B]_t = t.
    \tag{6}
    \]
  </div>
  <p class="explain">
    In differential form, \((dB_t)^2 = dt\) becomes the cornerstone of Itô calculus.
  </p>

  <!-- ----- 2.3 Connection to Diffusion Models ----- -->
  <h3 id="brownian-connection">2.3 Connection to Diffusion Models</h3>
  <p class="lead">
    The identity \((dB_t)^2 = dt\) is not just an abstract feature of Brownian motion; it is the
    linchpin in the mathematics of diffusion models.
  </p>
  <p>
    Consider a stochastic differential equation (SDE):
  </p>
  <div class="eq-scroll">
    \[
      dx_t = \mu(x_t, t)\,dt + \sigma(t)\,dB_t.
    \tag{7}
    \]
  </div>
  <p>
    Here \(\mu(x_t, t)\) is the drift and \(\sigma(t)\) the diffusion coefficient. When applying Itô’s lemma:
  </p>
  <ul>
    <li><strong>\(dB_t\):</strong> contributes random noise.</li>
    <li><strong>\((dB_t)^2\):</strong> contributes deterministic drift correction via \(dt\).</li>
  </ul>
  <p class="bridge">
    Without \((dB_t)^2=dt\), the derivation of the <strong>Fokker–Planck PDE</strong> (Section 3) and the
    <strong>reverse-time SDE</strong> (Section 4) would break down.
  </p>
  <p class="note">
    <strong>Key Takeaway:</strong> \((dB_t)^2=dt\) bridges random fluctuations to smooth density evolution, enabling Gaussian marginals.
  </p>
</section>
